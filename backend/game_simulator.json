{
  "name": "online_game_simulator",
  "path": "/game-sim",
  "method": "GET",
  "description": "Online game simulator - stress test for high-frequency requests",
  "logic": [
    {
      "return": {
        "value": {
          "status": 200,
          "html": "<!DOCTYPE html><html><head><meta charset='UTF-8'><title>Online Game Simulator</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:20px;color:white}.container{max-width:1400px;margin:0 auto}.header{text-align:center;margin-bottom:30px}.header h1{font-size:3em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.5)}.header p{font-size:1.2em;opacity:0.9}.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:rgba(255,255,255,0.1);padding:20px;border-radius:15px;backdrop-filter:blur(10px);text-align:center;border:2px solid rgba(255,255,255,0.2)}.stat-label{font-size:0.9em;opacity:0.8;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px}.stat-value{font-size:2.5em;font-weight:bold;color:#00ff88}.simulator{background:rgba(0,0,0,0.3);padding:30px;border-radius:20px;backdrop-filter:blur(10px);margin-bottom:20px}.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin-bottom:20px}.control-group{background:rgba(255,255,255,0.05);padding:15px;border-radius:10px}.control-group label{display:block;margin-bottom:8px;font-size:0.9em;opacity:0.8}.control-group input,.control-group select{width:100%;padding:10px;border:none;border-radius:8px;background:rgba(255,255,255,0.1);color:white;font-size:1em}.btn{background:linear-gradient(135deg,#00ff88,#00d4ff);color:#000;border:none;padding:15px 30px;font-size:1.1em;font-weight:bold;border-radius:50px;cursor:pointer;transition:all 0.3s;box-shadow:0 5px 15px rgba(0,255,136,0.3);margin:5px}.btn:hover{transform:translateY(-2px);box-shadow:0 7px 20px rgba(0,255,136,0.5)}.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}.btn-danger{background:linear-gradient(135deg,#ff0088,#ff4444)}.log-container{background:rgba(0,0,0,0.5);padding:20px;border-radius:10px;max-height:300px;overflow-y:auto;font-family:monospace;font-size:0.9em}.log-entry{padding:5px 0;border-bottom:1px solid rgba(255,255,255,0.1)}.log-entry.success{color:#00ff88}.log-entry.error{color:#ff4444}.log-entry.info{color:#00d4ff}.progress-bar{width:100%;height:30px;background:rgba(0,0,0,0.3);border-radius:15px;overflow:hidden;margin:15px 0}.progress-fill{height:100%;background:linear-gradient(90deg,#00ff88,#00d4ff);transition:width 0.3s;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#000}</style></head><body><div class='container'><div class='header'><h1>üéÆ Online Game Simulator</h1><p>Test Rust Backend Performance with High-Frequency Requests</p><p style='font-size:0.8em;opacity:0.6'>v2.1 - Enhanced Logging</p></div><div class='dashboard'><div class='stat-card'><div class='stat-label'>Total Requests</div><div class='stat-value' id='totalReqs'>0</div></div><div class='stat-card'><div class='stat-label'>Successful</div><div class='stat-value' id='successReqs'>0</div></div><div class='stat-card'><div class='stat-label'>Failed</div><div class='stat-value' id='failedReqs' style='color:#ff4444'>0</div></div><div class='stat-card'><div class='stat-label'>Avg Response</div><div class='stat-value' id='avgResponse'>0ms</div></div><div class='stat-card'><div class='stat-label'>Requests/sec</div><div class='stat-value' id='rps'>0</div></div><div class='stat-card'><div class='stat-label'>Active Players</div><div class='stat-value' id='players'>0</div></div></div><div class='simulator'><h2 style='margin-bottom:20px'>Simulation Settings</h2><div class='controls'><div class='control-group'><label>Number of Players</label><input type='number' id='playerCount' value='10' min='1' max='500'></div><div class='control-group'><label>Requests per Second (per player)</label><input type='number' id='reqPerSec' value='2' min='1' max='50'></div><div class='control-group'><label>Duration (seconds)</label><input type='number' id='duration' value='5' min='1' max='60'></div><div class='control-group'><label>Simulation Type</label><select id='simType'><option value='constant'>Constant Load</option><option value='burst'>Burst Traffic</option><option value='ramp'>Ramp Up</option></select></div></div><div style='text-align:center;margin-top:20px'><button class='btn' onclick='lightTest()'>üí® Light Test (3 players, 3s)</button><button class='btn' onclick='quickTest()'>‚ö° Quick Test (5 players, 5s)</button><button class='btn' onclick='startSimulation()' id='startBtn'>üöÄ Start Custom</button><button class='btn btn-danger' onclick='stopSimulation()' id='stopBtn' disabled>‚èπ Stop</button></div><div class='progress-bar' style='display:none' id='progressBar'><div class='progress-fill' id='progressFill'>0%</div></div></div><div class='log-container' id='logContainer'><div class='log-entry info'>Ready to simulate online game traffic...</div></div></div><script>let running=false;let stats={total:0,success:0,failed:0,totalTime:0};let startTime=0;let simInterval=null;let updateInterval=null;let activeRequests=0;const MAX_CONCURRENT=20;let requestQueue=[];function log(msg,type='info'){const log=document.getElementById('logContainer');const entry=document.createElement('div');entry.className='log-entry '+type;entry.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;log.insertBefore(entry,log.firstChild);if(log.children.length>50)log.removeChild(log.lastChild);}function updateStats(){document.getElementById('totalReqs').textContent=stats.total;document.getElementById('successReqs').textContent=stats.success;document.getElementById('failedReqs').textContent=stats.failed;const avg=stats.success>0?(stats.totalTime/stats.success).toFixed(2):'0';document.getElementById('avgResponse').textContent=avg+'ms';const elapsed=(Date.now()-startTime)/1000;const rps=elapsed>0?(stats.total/elapsed).toFixed(1):'0';document.getElementById('rps').textContent=rps;document.getElementById('players').textContent=document.getElementById('playerCount').value;}async function executeRequest(playerId){activeRequests++;const reqStart=performance.now();try{const res=await fetch('/api/game-action',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({player_id:playerId,action:'move',timestamp:Date.now()})});const data=await res.json();const reqEnd=performance.now();const time=reqEnd-reqStart;stats.total++;stats.success++;stats.totalTime+=time;if(stats.total%100===0){log(`‚úÖ ${stats.total} requests | Avg: ${(stats.totalTime/stats.success).toFixed(2)}ms | Active: ${activeRequests}`,'success');}}catch(err){stats.total++;stats.failed++;if(stats.failed%10===0){log(`‚ùå Request failed: ${err.message}`,'error');}}finally{activeRequests--;processQueue();}}function processQueue(){while(requestQueue.length>0&&activeRequests<MAX_CONCURRENT){const playerId=requestQueue.shift();executeRequest(playerId);}}function sendRequest(playerId){if(activeRequests<MAX_CONCURRENT){executeRequest(playerId);}else{requestQueue.push(playerId);}}function startSimulation(){if(running)return;running=true;stats={total:0,success:0,failed:0,totalTime:0};activeRequests=0;requestQueue=[];startTime=Date.now();document.getElementById('startBtn').disabled=true;document.getElementById('stopBtn').disabled=false;document.getElementById('progressBar').style.display='block';const players=parseInt(document.getElementById('playerCount').value);const rps=parseInt(document.getElementById('reqPerSec').value);const duration=parseInt(document.getElementById('duration').value);const simType=document.getElementById('simType').value;log(`üöÄ Starting simulation: ${players} players, ${rps} req/s each, ${duration}s duration`,'info');const totalExpected=players*rps*duration;const totalRPS=players*rps;log(`üìä Expected: ${totalExpected} requests total (${totalRPS} req/s) | Concurrent limit: ${MAX_CONCURRENT}`,'info');const interval=1000/rps;let currentPlayers=simType==='ramp'?1:players;simInterval=setInterval(()=>{if(!running)return;if(simType==='ramp'){currentPlayers=Math.min(players,currentPlayers+1);}else if(simType==='burst'){currentPlayers=Math.random()>0.5?players:Math.floor(players*0.3);}for(let i=0;i<currentPlayers;i++){sendRequest(i);}},interval);updateInterval=setInterval(updateStats,100);setTimeout(()=>{if(running){stopSimulation();const avgResp=(stats.totalTime/stats.success).toFixed(2);const throughput=(stats.total/duration).toFixed(1);log(`‚úÖ Simulation completed!`,'success');log(`üìä Results: ${stats.success}/${stats.total} requests (${((stats.success/stats.total)*100).toFixed(1)}%) | Avg: ${avgResp}ms | Throughput: ${throughput} req/s`,'success');}},duration*1000);let progressInterval=setInterval(()=>{const elapsed=(Date.now()-startTime)/1000;const progress=Math.min(100,(elapsed/duration)*100);document.getElementById('progressFill').style.width=progress+'%';document.getElementById('progressFill').textContent=progress.toFixed(0)+'%';if(progress>=100)clearInterval(progressInterval);},100);}function stopSimulation(){running=false;if(simInterval)clearInterval(simInterval);if(updateInterval)clearInterval(updateInterval);document.getElementById('startBtn').disabled=false;document.getElementById('stopBtn').disabled=true;log('‚èπ Simulation stopped','info');}function lightTest(){document.getElementById('playerCount').value='3';document.getElementById('reqPerSec').value='2';document.getElementById('duration').value='3';document.getElementById('simType').value='constant';setTimeout(()=>startSimulation(),100);}function quickTest(){document.getElementById('playerCount').value='5';document.getElementById('reqPerSec').value='3';document.getElementById('duration').value='5';document.getElementById('simType').value='constant';setTimeout(()=>startSimulation(),100);}</script></body></html>"
        }
      }
    }
  ],
  "enabled": true,
  "version": "1.0"
}
